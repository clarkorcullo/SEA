{% extends "base.html" %}

{% block title %}{{ user.full_name }} - User Details{% endblock %}

{% block content %}
<style>
.admin-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 2rem 0;
    margin-bottom: 2rem;
    border-radius: 10px;
}

.user-profile {
    background: white;
    border-radius: 10px;
    padding: 2rem;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
}

.user-avatar-large {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid #e9ecef;
}

.progress-section {
    background: white;
    border-radius: 10px;
    padding: 1.5rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
}

.activity-section {
    background: white;
    border-radius: 10px;
    padding: 1.5rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
}

.activity-item {
    padding: 1rem 0;
    border-bottom: 1px solid #f8f9fa;
}

.activity-item:last-child {
    border-bottom: none;
}

.stat-card {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 1rem;
    text-align: center;
}

.stat-number {
    font-size: 1.5rem;
    font-weight: bold;
    color: #007bff;
}

.stat-label {
    font-size: 0.9rem;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.admin-nav {
    background: white;
    border-radius: 10px;
    padding: 1rem;
    margin-bottom: 2rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.admin-nav .nav-link {
    color: #495057;
    font-weight: 500;
    padding: 0.75rem 1rem;
    border-radius: 5px;
    transition: all 0.3s ease;
}

.admin-nav .nav-link:hover {
    background: #f8f9fa;
    color: #007bff;
}

.admin-nav .nav-link.active {
    background: #007bff;
    color: white;
}
</style>

<div class="admin-header text-center">
    <div class="container">
        <h1 class="mb-3">
            <i class="fas fa-user"></i> User Details
        </h1>
        <p class="lead mb-0">Detailed information about {{ user.full_name }}</p>
    </div>
</div>

<div class="container">
    <!-- Admin Navigation -->
    <div class="admin-nav">
        <nav class="nav nav-pills nav-fill">
            <a class="nav-link" href="{{ url_for('admin_dashboard') }}">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a class="nav-link" href="{{ url_for('admin_users') }}">
                <i class="fas fa-users"></i> Users
            </a>
            <a class="nav-link" href="{{ url_for('admin_modules') }}">
                <i class="fas fa-book"></i> Modules
            </a>
            <a class="nav-link" href="{{ url_for('admin_analytics') }}">
                <i class="fas fa-chart-bar"></i> Analytics
            </a>
            <a class="nav-link" href="{{ url_for('admin_settings') }}">
                <i class="fas fa-cog"></i> Settings
            </a>
        </nav>
    </div>

    <!-- User Profile -->
    <div class="user-profile">
        <div class="row">
            <div class="col-md-3 text-center">
                {% if user.profile_picture %}
                    <img src="{{ url_for('static', filename='profile_pictures/' + user.profile_picture) }}" 
                         alt="Profile" class="user-avatar-large mb-3">
                {% else %}
                    <div class="user-avatar-large bg-primary d-flex align-items-center justify-content-center text-white mx-auto mb-3">
                        <i class="fas fa-user fa-3x"></i>
                    </div>
                {% endif %}
                <h4>{{ user.full_name }}</h4>
                <p class="text-muted">{{ user.specialization }} - {{ user.year_level }}</p>
                <div class="d-grid gap-2">
                    <a href="{{ url_for('admin_edit_user', user_id=user.id) }}" class="btn btn-primary">
                        <i class="fas fa-edit"></i> Edit User
                    </a>
                    <a href="{{ url_for('admin_users') }}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left"></i> Back to Users
                    </a>
                </div>
            </div>
            <div class="col-md-9">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-muted">Personal Information</h6>
                        <table class="table table-borderless">
                            <tr>
                                <td><strong>Username:</strong></td>
                                <td>{{ user.username }}</td>
                            </tr>
                            <tr>
                                <td><strong>Email:</strong></td>
                                <td>{{ user.email }}</td>
                            </tr>
                            <tr>
                                <td><strong>Full Name:</strong></td>
                                <td>{{ user.full_name }}</td>
                            </tr>
                            <tr>
                                <td><strong>Specialization:</strong></td>
                                <td>{{ user.specialization }}</td>
                            </tr>
                            <tr>
                                <td><strong>Year Level:</strong></td>
                                <td>{{ user.year_level }}</td>
                            </tr>
                            {% if user.birthday %}
                            <tr>
                                <td><strong>Birthday:</strong></td>
                                <td>{{ user.birthday.strftime('%B %d, %Y') }}</td>
                            </tr>
                            {% endif %}
                            {% if user.address %}
                            <tr>
                                <td><strong>Address:</strong></td>
                                <td>{{ user.address }}</td>
                            </tr>
                            {% endif %}
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-muted">Account Information</h6>
                        <table class="table table-borderless">
                            <tr>
                                <td><strong>Member Since:</strong></td>
                                <td>{{ user.created_at.strftime('%B %d, %Y') }}</td>
                            </tr>
                            <tr>
                                <td><strong>Last Updated:</strong></td>
                                <td>{{ user.updated_at.strftime('%B %d, %Y at %I:%M %p') }}</td>
                            </tr>
                            <tr>
                                <td><strong>Account Status:</strong></td>
                                <td>
                                    {% if user.username == 'administrator' %}
                                        <span class="badge bg-warning">Administrator</span>
                                    {% else %}
                                        <span class="badge bg-success">Active</span>
                                    {% endif %}
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Progress Statistics -->
    <div class="progress-section">
        <h5 class="mb-3">
            <i class="fas fa-chart-line text-primary"></i> Learning Progress
        </h5>
        <div class="row">
            <div class="col-md-3 mb-3">
                <div class="stat-card">
                    <div class="stat-number">{{ user.modules_completed }}</div>
                    <div class="stat-label">Modules Completed</div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card">
                    <div class="stat-number">{{ user.simulations_completed }}</div>
                    <div class="stat-label">Simulations Completed</div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card">
                    <div class="stat-number">{{ user.total_score }}</div>
                    <div class="stat-label">Total Score</div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card">
                    <div class="stat-number">{{ "%.1f"|format(user.completion_percentage) }}%</div>
                    <div class="stat-label">Completion</div>
                </div>
            </div>
        </div>
        
        <!-- Overall Progress Bar -->
        <div class="mt-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span><strong>Overall Progress</strong></span>
                <span>{{ "%.1f"|format(user.completion_percentage) }}%</span>
            </div>
            <div class="progress" style="height: 10px;">
                <div class="progress-bar" style="width: {{ user.completion_percentage }}%"></div>
            </div>
        </div>
    </div>

    <!-- Module Progress -->
    <div class="progress-section">
        <h5 class="mb-3">
            <i class="fas fa-book text-success"></i> Module Progress
        </h5>
        {% if progress and progress|length > 0 %}
        <div class="row">
            {% for module_progress in progress %}
            <div class="col-md-6 mb-3">
                <div class="d-flex justify-content-between align-items-center">
                    <span><strong>Module {{ module_progress.module_id }}</strong></span>
                    {% if module_progress.completed %}
                        <span class="badge bg-success">Completed</span>
                    {% elif module_progress.status == 'in_progress' %}
                        <span class="badge bg-warning">In Progress</span>
                    {% else %}
                        <span class="badge bg-secondary">Not Started</span>
                    {% endif %}
                </div>
                <div class="progress mt-1" style="height: 6px;">
                    <div class="progress-bar 
                        {% if module_progress.completed %}bg-success
                        {% elif module_progress.status == 'in_progress' %}bg-warning
                        {% else %}bg-secondary{% endif %}" 
                        style="width: {{ module_progress.completion_percentage }}%">
                    </div>
                </div>
                <small class="text-muted">
                    Score: {{ max(module_progress.score, module_progress.highest_score) }} (Best: {{ module_progress.highest_score }}) | 
                    Time: {{ module_progress.time_spent }} min | 
                    Updated: {{ module_progress.updated_at.strftime('%m/%d/%Y') }}
                </small>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center text-muted py-4">
            <i class="fas fa-info-circle fa-2x mb-2"></i>
            <p>No module progress data available for this user.</p>
        </div>
        {% endif %}
    </div>

    <!-- Recent Assessments -->
    {% if assessments %}
    <div class="activity-section">
        <h5 class="mb-3">
            <i class="fas fa-clipboard-check text-info"></i> Recent Assessments
        </h5>
        {% for assessment in assessments[:5] %}
        <div class="activity-item">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <strong>{{ assessment.assessment_type.replace('_', ' ').title() }}</strong>
                    <br>
                    <small class="text-muted">
                        Score: {{ assessment.correct_answers }}/{{ assessment.total_questions }}
                        ({{ "%.1f"|format((assessment.correct_answers / assessment.total_questions * 100) if assessment.total_questions > 0 else 0) }}%)
                    </small>
                </div>
                <div class="text-right">
                    {% if assessment.passed %}
                        <span class="badge bg-success">Passed</span>
                    {% else %}
                        <span class="badge bg-danger">Failed</span>
                    {% endif %}
                    <br>
                    <small class="text-muted">{{ assessment.created_at.strftime('%m/%d/%Y') }}</small>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Recent Simulations -->
    {% if simulations %}
    <div class="activity-section">
        <h5 class="mb-3">
            <i class="fas fa-gamepad text-warning"></i> Recent Simulations
        </h5>
        {% for simulation in simulations[:5] %}
        <div class="activity-item">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <strong>{{ simulation.simulation_type.replace('_', ' ').title() }}</strong>
                    <br>
                    <small class="text-muted">
                        Score: {{ simulation.score }}/{{ simulation.max_score }}
                        ({{ "%.1f"|format((simulation.score / simulation.max_score * 100) if simulation.max_score > 0 else 0) }}%)
                    </small>
                </div>
                <div class="text-right">
                    {% if simulation.completed %}
                        <span class="badge bg-success">Completed</span>
                    {% else %}
                        <span class="badge bg-warning">In Progress</span>
                    {% endif %}
                    <br>
                    <small class="text-muted">{{ simulation.created_at.strftime('%m/%d/%Y') }}</small>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endblock %}
