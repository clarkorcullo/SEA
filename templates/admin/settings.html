{% extends "base.html" %}

{% block title %}System Settings - Admin Dashboard{% endblock %}

{% block content %}
<style>
.admin-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 2rem 0;
    margin-bottom: 2rem;
    border-radius: 10px;
}

.settings-card {
    background: white;
    border-radius: 10px;
    padding: 2rem;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
}

.settings-section {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
}

.section-title {
    color: #495057;
    font-weight: 600;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #dee2e6;
}

.admin-nav {
    background: white;
    border-radius: 10px;
    padding: 1rem;
    margin-bottom: 2rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.admin-nav .nav-link {
    color: #495057;
    font-weight: 500;
    padding: 0.75rem 1rem;
    border-radius: 5px;
    transition: all 0.3s ease;
}

.admin-nav .nav-link:hover {
    background: #f8f9fa;
    color: #007bff;
}

.admin-nav .nav-link.active {
    background: #007bff;
    color: white;
}

.system-info {
    background: #e9ecef;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
}

.info-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid #dee2e6;
}

.info-item:last-child {
    border-bottom: none;
}

.danger-zone {
    background: #f8d7da;
    border: 1px solid #f5c6cb;
    border-radius: 8px;
    padding: 1.5rem;
    margin-top: 2rem;
}

.danger-zone .section-title {
    color: #721c24;
    border-bottom-color: #f5c6cb;
}

.maintenance-card, .db-card, .danger-card {
    transition: all 0.3s ease;
    background: white !important;
}

.maintenance-card:hover, .db-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.danger-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(220,53,69,0.2);
    background: #fff5f5 !important;
}

.btn-sm {
    padding: 0.375rem 0.75rem;
    font-size: 0.875rem;
}
</style>

<div class="admin-header text-center">
    <div class="container">
        <h1 class="mb-3">
            <i class="fas fa-cog"></i> System Settings
        </h1>
        <p class="lead mb-0">Configure system settings and preferences</p>
    </div>
</div>

<div class="container">
    <!-- Admin Navigation -->
    <div class="admin-nav">
        <nav class="nav nav-pills nav-fill">
            <a class="nav-link" href="{{ url_for('admin_dashboard') }}">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a class="nav-link" href="{{ url_for('admin_users') }}">
                <i class="fas fa-users"></i> Users
            </a>
            <a class="nav-link" href="{{ url_for('admin_modules') }}">
                <i class="fas fa-book"></i> Modules
            </a>
            <a class="nav-link" href="{{ url_for('admin_analytics') }}">
                <i class="fas fa-chart-bar"></i> Analytics
            </a>
            <a class="nav-link active" href="{{ url_for('admin_settings') }}">
                <i class="fas fa-cog"></i> Settings
            </a>
        </nav>
    </div>

    <!-- System Information -->
    <div class="settings-card">
        <h4 class="section-title">
            <i class="fas fa-info-circle text-primary"></i> System Information
        </h4>
        <div class="system-info">
            <div class="info-item">
                <span><strong>Application Name:</strong></span>
                <span>Social Engineering Awareness Program</span>
            </div>
            <div class="info-item">
                <span><strong>Version:</strong></span>
                <span>1.0.0</span>
            </div>
            <div class="info-item">
                <span><strong>Python Version:</strong></span>
                <span>3.11</span>
            </div>
            <div class="info-item">
                <span><strong>Flask Version:</strong></span>
                <span>2.3.0</span>
            </div>
            <div class="info-item">
                <span><strong>Database:</strong></span>
                <span>SQLite</span>
            </div>
            <div class="info-item">
                <span><strong>Environment:</strong></span>
                <span>Development</span>
            </div>
        </div>
    </div>

    <!-- Application Settings -->
    <div class="settings-card">
        <h4 class="section-title">
            <i class="fas fa-sliders-h text-success"></i> Application Settings
        </h4>
        <form>
            <div class="settings-section">
                <h6 class="mb-3">General Settings</h6>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="app_name" class="form-label">Application Name</label>
                        <input type="text" class="form-control" id="app_name" value="Social Engineering Awareness Program">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="app_description" class="form-label">Description</label>
                        <input type="text" class="form-control" id="app_description" value="Comprehensive social engineering awareness training program">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="max_users" class="form-label">Maximum Users</label>
                        <input type="number" class="form-control" id="max_users" value="1000">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="session_timeout" class="form-label">Session Timeout (minutes)</label>
                        <input type="number" class="form-control" id="session_timeout" value="30">
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h6 class="mb-3">Assessment Settings</h6>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="passing_score" class="form-label">Knowledge Check Passing Score (%)</label>
                        <input type="number" class="form-control" id="passing_score" value="80" min="0" max="100">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="final_passing_score" class="form-label">Final Assessment Passing Score (%)</label>
                        <input type="number" class="form-control" id="final_passing_score" value="80" min="0" max="100">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="max_attempts" class="form-label">Maximum Attempts per Assessment</label>
                        <input type="number" class="form-control" id="max_attempts" value="3" min="1">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="time_limit" class="form-label">Assessment Time Limit (minutes)</label>
                        <input type="number" class="form-control" id="time_limit" value="30" min="5">
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h6 class="mb-3">Email Settings</h6>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="smtp_server" class="form-label">SMTP Server</label>
                        <input type="text" class="form-control" id="smtp_server" value="smtp.gmail.com">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="smtp_port" class="form-label">SMTP Port</label>
                        <input type="number" class="form-control" id="smtp_port" value="587">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="email_username" class="form-label">Email Username</label>
                        <input type="email" class="form-control" id="email_username" value="admin@mmdc.edu.ph">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="email_password" class="form-label">Email Password</label>
                        <input type="password" class="form-control" id="email_password" placeholder="Enter email password">
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-end">
                <button type="button" class="btn btn-primary" onclick="saveSettings()">
                    <i class="fas fa-save"></i> Save Settings
                </button>
            </div>
        </form>
    </div>

    <!-- Database Management -->
    <div class="settings-card">
        <h4 class="section-title">
            <i class="fas fa-database text-info"></i> Database Management
        </h4>
        <div class="row">
            <div class="col-md-6 col-lg-4 mb-3">
                <div class="db-card text-center p-4 border rounded bg-light">
                    <i class="fas fa-download fa-3x text-primary mb-3"></i>
                    <h6>Backup Database</h6>
                    <p class="text-muted small">Create a secure backup of the current database with all user data and progress</p>
                    <button class="btn btn-primary btn-sm w-100" onclick="backupDatabase()">
                        <i class="fas fa-download"></i> Create Backup
                    </button>
                </div>
            </div>
            <div class="col-md-6 col-lg-4 mb-3">
                <div class="db-card text-center p-4 border rounded bg-light">
                    <i class="fas fa-upload fa-3x text-success mb-3"></i>
                    <h6>Restore Database</h6>
                    <p class="text-muted small">Restore from a previous backup file (will replace current data)</p>
                    <button class="btn btn-success btn-sm w-100" onclick="restoreDatabase()">
                        <i class="fas fa-upload"></i> Restore Backup
                    </button>
                </div>
            </div>
            <div class="col-md-12 col-lg-4 mb-3">
                <div class="db-card text-center p-4 border rounded bg-light">
                    <i class="fas fa-sync-alt fa-3x text-warning mb-3"></i>
                    <h6>Reset Database</h6>
                    <p class="text-muted small">⚠️ Reset to initial state - This will permanently delete all user data and progress!</p>
                    <button class="btn btn-warning btn-sm w-100" onclick="resetDatabase()">
                        <i class="fas fa-sync-alt"></i> Reset Database
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- System Maintenance -->
    <div class="settings-card">
        <h4 class="section-title">
            <i class="fas fa-tools text-warning"></i> System Maintenance
        </h4>
        <div class="row">
            <div class="col-md-6 col-lg-3 mb-3">
                <div class="maintenance-card text-center p-3 border rounded">
                    <i class="fas fa-broom fa-2x text-primary mb-3"></i>
                    <h6>Clear Cache</h6>
                    <p class="text-muted small">Clear application cache and temporary files</p>
                    <button class="btn btn-primary btn-sm w-100" onclick="clearCache()">
                        <i class="fas fa-broom"></i> Clear Now
                    </button>
                </div>
            </div>
            <div class="col-md-6 col-lg-3 mb-3">
                <div class="maintenance-card text-center p-3 border rounded">
                    <i class="fas fa-tachometer-alt fa-2x text-success mb-3"></i>
                    <h6>Optimize Database</h6>
                    <p class="text-muted small">Optimize database performance and cleanup</p>
                    <button class="btn btn-success btn-sm w-100" onclick="optimizeDatabase()">
                        <i class="fas fa-tachometer-alt"></i> Optimize
                    </button>
                </div>
            </div>
            <div class="col-md-6 col-lg-3 mb-3">
                <div class="maintenance-card text-center p-3 border rounded">
                    <i class="fas fa-file-alt fa-2x text-info mb-3"></i>
                    <h6>Generate Reports</h6>
                    <p class="text-muted small">Generate system logs and diagnostic reports</p>
                    <button class="btn btn-info btn-sm w-100" onclick="generateLogs()">
                        <i class="fas fa-file-alt"></i> Generate
                    </button>
                </div>
            </div>
            <div class="col-md-6 col-lg-3 mb-3">
                <div class="maintenance-card text-center p-3 border rounded">
                    <i class="fas fa-heartbeat fa-2x text-warning mb-3"></i>
                    <h6>System Health</h6>
                    <p class="text-muted small">Check system status and health metrics</p>
                    <button class="btn btn-warning btn-sm w-100" onclick="systemHealth()">
                        <i class="fas fa-heartbeat"></i> Check Health
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Danger Zone -->
    <div class="settings-card">
        <div class="danger-zone">
            <h4 class="section-title">
                <i class="fas fa-exclamation-triangle text-danger"></i> Danger Zone
            </h4>
            <div class="alert alert-danger" role="alert">
                <i class="fas fa-warning"></i> <strong>Warning:</strong> These actions are <strong>irreversible</strong> and will permanently delete data. Please proceed with extreme caution and ensure you have backups.
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <div class="danger-card text-center p-3 border border-danger rounded">
                        <i class="fas fa-users-slash fa-2x text-danger mb-3"></i>
                        <h6 class="text-danger">Delete All Users</h6>
                        <p class="text-muted small">Permanently delete all user accounts and their associated data</p>
                        <button class="btn btn-danger btn-sm w-100" onclick="deleteAllUsers()">
                            <i class="fas fa-users-slash"></i> Delete All Users
                        </button>
                    </div>
                </div>
                <div class="col-md-6 mb-3">
                    <div class="danger-card text-center p-3 border border-danger rounded">
                        <i class="fas fa-trash-alt fa-2x text-danger mb-3"></i>
                        <h6 class="text-danger">Reset Entire System</h6>
                        <p class="text-muted small">Complete system reset - deletes all data and returns to initial state</p>
                        <button class="btn btn-danger btn-sm w-100" onclick="resetSystem()">
                            <i class="fas fa-trash-alt"></i> Reset System
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function saveSettings() {
    // Show loading state
    const saveBtn = document.querySelector('button[onclick="saveSettings()"]');
    const originalText = saveBtn.innerHTML;
    saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
    saveBtn.disabled = true;
    
    // Simulate API call
    setTimeout(() => {
        saveBtn.innerHTML = originalText;
        saveBtn.disabled = false;
        
        modalSystem.success(
            'Settings Saved',
            'All settings have been saved successfully! The system will apply these changes immediately.',
            {
                confirmText: 'OK'
            }
        );
    }, 1500);
}

function backupDatabase() {
    modalSystem.confirm(
        'Create Database Backup',
        'This will create a complete backup of your database including all user data, progress, and system settings. Continue?',
        {
            confirmText: 'Create Backup',
            cancelText: 'Cancel'
        }
    ).then(confirmed => {
        if (confirmed) {
            modalSystem.success(
                'Backup Created',
                'Database backup has been created successfully! The backup file has been saved to your downloads folder.',
                {
                    confirmText: 'OK'
                }
            );
        }
    });
}

function restoreDatabase() {
    modalSystem.confirm(
        'Restore Database',
        '⚠️ WARNING: This will replace your current database with the backup file. All current data will be lost! Are you sure you want to continue?',
        {
            confirmText: 'Restore Database',
            cancelText: 'Cancel'
        }
    ).then(confirmed => {
        if (confirmed) {
            modalSystem.success(
                'Database Restored',
                'Database has been successfully restored from the backup file. The system will restart to apply changes.',
                {
                    confirmText: 'OK'
                }
            );
        }
    });
}

function resetDatabase() {
    modalSystem.confirm(
        'Reset Database',
        'Are you sure you want to reset the database? This will delete ALL data and cannot be undone!',
        {
            confirmText: 'Reset Database',
            cancelText: 'Cancel'
        }
    ).then(confirmed => {
        if (confirmed) {
            modalSystem.info(
                'Database Reset',
                'Database reset functionality will be implemented in the next version.',
                {
                    confirmText: 'OK'
                }
            );
        }
    });
}

function clearCache() {
    modalSystem.confirm(
        'Clear Cache',
        'This will clear all application cache and temporary files. This may improve performance but users may experience slower loading on first visit. Continue?',
        {
            confirmText: 'Clear Cache',
            cancelText: 'Cancel'
        }
    ).then(confirmed => {
        if (confirmed) {
            modalSystem.success(
                'Cache Cleared',
                'Application cache and temporary files have been cleared successfully! Performance should be improved.',
                {
                    confirmText: 'OK'
                }
            );
        }
    });
}

function optimizeDatabase() {
    modalSystem.confirm(
        'Optimize Database',
        'This will optimize the database structure and clean up unused data. This process may take a few minutes. Continue?',
        {
            confirmText: 'Optimize Database',
            cancelText: 'Cancel'
        }
    ).then(confirmed => {
        if (confirmed) {
            modalSystem.success(
                'Database Optimized',
                'Database optimization completed successfully! The database is now running at peak performance.',
                {
                    confirmText: 'OK'
                }
            );
        }
    });
}

function generateLogs() {
    modalSystem.confirm(
        'Generate System Reports',
        'This will generate comprehensive system logs, diagnostic reports, and analytics data. The report will be downloaded as a ZIP file. Continue?',
        {
            confirmText: 'Generate Reports',
            cancelText: 'Cancel'
        }
    ).then(confirmed => {
        if (confirmed) {
            modalSystem.success(
                'Reports Generated',
                'System reports have been generated successfully! The ZIP file containing logs and diagnostics has been downloaded.',
                {
                    confirmText: 'OK'
                }
            );
        }
    });
}

function systemHealth() {
    modalSystem.confirm(
        'Run System Health Check',
        'This will perform a comprehensive system health check including database connectivity, performance metrics, and system resources. Continue?',
        {
            confirmText: 'Run Health Check',
            cancelText: 'Cancel'
        }
    ).then(confirmed => {
        if (confirmed) {
            modalSystem.success(
                'System Health Check Complete',
                '✅ System Status: All systems operational\n✅ Database: Connected and responsive\n✅ Performance: Optimal\n✅ Resources: Healthy\n\nAll components are functioning normally.',
                {
                    confirmText: 'OK'
                }
            );
        }
    });
}

function deleteAllUsers() {
    modalSystem.confirm(
        'Delete All Users',
        'Are you sure you want to delete ALL users? This action cannot be undone!',
        {
            confirmText: 'Delete All Users',
            cancelText: 'Cancel'
        }
    ).then(confirmed => {
        if (confirmed) {
            modalSystem.info(
                'Delete Users',
                'Delete all users functionality will be implemented in the next version.',
                {
                    confirmText: 'OK'
                }
            );
        }
    });
}

function resetSystem() {
    modalSystem.confirm(
        'Reset Entire System',
        'Are you sure you want to reset the ENTIRE system? This will delete ALL data and cannot be undone!',
        {
            confirmText: 'Reset System',
            cancelText: 'Cancel'
        }
    ).then(confirmed => {
        if (confirmed) {
            modalSystem.info(
                'System Reset',
                'System reset functionality will be implemented in the next version.',
                {
                    confirmText: 'OK'
                }
            );
        }
    });
}
</script>
{% endblock %}
